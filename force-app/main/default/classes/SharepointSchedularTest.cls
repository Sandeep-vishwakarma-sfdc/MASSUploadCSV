@isTest
public with sharing class SharepointSchedularTest {

    @TestSetup
    static void makeData(){
        SharePointDetails__c details = new SharePointDetails__c();
        details.Name ='MarginBlockCLI';
        details.AuthorizationURL__c = 'https://accounts.accesscontrol.windows.net/8bc97f9a-ea86-472e-8ab7-19db58c4c8af/tokens/OAuth/2';
        details.Client_Id__c = 'b0bbcedf-ed45-4aa9-a9e3-1bc56d31a1b4@8bc97f9a-ea86-472e-8ab7-19db58c4c8af';
        details.Client_Secret__c = 'Mj4mCQnwGE%2fgWgOF0Ct090AdWBjXU%2fCLYfiD%2B656y8Q%3D';
        details.Get_CSV_File_URL__c = '';
        details.Get_Files_URL__c = 'https://upllimited.sharepoint.com/sites/spdevelopment/_api/web/GetFolderByServerRelativeUrl(\'/sites/spdevelopment/PLNMarginData/';
        details.Grant_Type__c = 'client_credentials';
        details.Resource__c = '00000003-0000-0ff1-ce00-000000000000/upllimited.sharepoint.com@8bc97f9a-ea86-472e-8ab7-19db58c4c8af';

        insert details;
        
         MassUploadExternalIdRecords__c ext = new MassUploadExternalIdRecords__c();
        ext.Name='Price_Block_Margin_Matrix__c(SalesDed)';
        ext.Type__c='SalesDeduction';
        ext.FieldUseInCombinationKey__c='Profit_Center__r;Sales_Org__r;Dc;Div;SKU_Code__r;UOM__c;Type__c';
        ext.DataType__c='';
        ext.TypeApiName__c='Type__c';
        ext.ExternalId__c='Combination_Key__c';
        ext.ObjectName__c='Price_Block_Margin_Matrix__c';
        ext.CSVFields__c='Profit_Center__r;Sales_Org__r;Dc;Div;SKU_Code__r;UOM__c;Sales_Deduction_LC__c;Sales_Deduction_USD__c;Start_Date__c;End_Date__c';
        ext.Length__c=null;
        insert ext;
        
        Trigger_Settings__c triggerSetting = new Trigger_Settings__c(
            Name ='MassUploadCSVTrigger', 
            IsActive__c = true , 
            ObjectName__c = 'Mass_Upload_CSV__c'
        );
        insert triggerSetting;
        
        Integration_Files__c iFile = new Integration_Files__c();
        iFile.Folder_Name__c = 'folder1';
        iFile.File_Name__c = 'Sales_Deduction_1';
        iFile.Folder_Name__c = 'folder1';
        insert iFile;
            
    }

    @isTest 
    static void testCallout() {
        ConnectToSharePoint.AccessTokenResponse token = new ConnectToSharePoint.AccessTokenResponse();
        token.access_token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvdXBsbGltaXRlZC5zaGFyZXBvaW50LmNvbUA4YmM5N2Y5YS1lYTg2LTQ3MmUtOGFiNy0xOWRiNThjNGM4YWYiLCJpc3MiOiIwMDAwMDAwMS0wMDAwLTAwMDAtYzAwMC0wMDAwMDAwMDAwMDBAOGJjOTdmOWEtZWE4Ni00NzJlLThhYjctMTlkYjU4YzRjOGFmIiwiaWF0IjoxNjY0MTkyNTcxLCJuYmYiOjE2NjQxOTI1NzEsImV4cCI6MTY2NDI3OTI3MSwiaWRlbnRpdHlwcm92aWRlciI6IjAwMDAwMDAxLTAwMDAtMDAwMC1jMDAwLTAwMDAwMDAwMDAwMEA4YmM5N2Y5YS1lYTg2LTQ3MmUtOGFiNy0xOWRiNThjNGM4YWYiLCJuYW1laWQiOiJiMGJiY2VkZi1lZDQ1LTRhYTktYTllMy0xYmM1NmQzMWExYjRAOGJjOTdmOWEtZWE4Ni00NzJlLThhYjctMTlkYjU4YzRjOGFmIiwib2lkIjoiYmU5M2EyNDEtMDRlOS00MzY2LTk4ZWUtMjQ2Nzk0MjYwNGUwIiwic3ViIjoiYmU5M2EyNDEtMDRlOS00MzY2LTk4ZWUtMjQ2Nzk0MjYwNGUwIiwidHJ1c3RlZGZvcmRlbGVnYXRpb24iOiJmYWxzZSJ9.EUaTDMdn8-3TiRS44R2hirSSPA88ILQ64bzWiFQfG0drDtQrf7TL4ky3U2kyqgYC1EopL0UFuQN4dGJNdQj-8nrxeGf9107TxPC-SOp-mysvdOd-cHJHS8u3TBKxCrhuKNsTsupX1j4ja4J8mtz852NHp8ChmI5XRpBiAucre0MB5uutFrOz4gtCV1rehpaYLCjmZoBDx9QL3Jx8JaCmcXME4shGMKUhSE8Omlln2BdujfhRpdOVmMreKGCX_v2n9baGvZWmczVjderc9FQn2a-jqb7c5mS7BEAl6n25WN2rh1iuVlre5_VslrfqCIErH_ZvfsFKJCnZk36OyTmEHg';
        Test.setMock(HttpCalloutMock.class, new MockHttpSharepoint(200,'OK',JSON.serialize(token),new Map<String,String>()));
        SharepointSchedular sch = new SharepointSchedular('folder1');
        sch.execute(null);
    }
    
    @isTest 
    static void testCallout1() {
        GetSharePointFilesResponse res = GetSharePointFilesResponse.parse('{"d":{"results":[{"__metadata":{"id":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')","uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')","type":"SP.File"},"Author":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/Author"}},"CheckedOutByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/CheckedOutByUser"}},"EffectiveInformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/EffectiveInformationRightsManagementSettings"}},"InformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/InformationRightsManagementSettings"}},"ListItemAllFields":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/ListItemAllFields"}},"LockedByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/LockedByUser"}},"ModifiedBy":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/ModifiedBy"}},"Properties":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/Properties"}},"VersionEvents":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/VersionEvents"}},"Versions":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv\')/Versions"}},"CheckInComment":"","CheckOutType":2,"ContentTag":"{6DFB201B-9ECA-48F7-879D-7996828AD958},1,1","CustomizedPageStatus":0,"ETag":"\\"{6DFB201B-9ECA-48F7-879D-7996828AD958},1\\"","Exists":true,"IrmEnabled":false,"Length":"5311257","Level":1,"LinkingUri":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv?d=w6dfb201b9eca48f7879d7996828ad958","LinkingUrl":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv?d=w6dfb201b9eca48f7879d7996828ad958","MajorVersion":1,"MinorVersion":0,"Name":"Discount.csv","ServerRelativeUrl":"/sites/SPDevelopment/PLNMarginData/folder1/Discount.csv","TimeCreated":"2022-09-23T11:57:22Z","TimeLastModified":"2022-09-23T11:57:22Z","Title":null,"UIVersion":512,"UIVersionLabel":"1.0","UniqueId":"6dfb201b-9eca-48f7-879d-7996828ad958"},{"__metadata":{"id":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')","uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')","type":"SP.File"},"Author":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/Author"}},"CheckedOutByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/CheckedOutByUser"}},"EffectiveInformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/EffectiveInformationRightsManagementSettings"}},"InformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/InformationRightsManagementSettings"}},"ListItemAllFields":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/ListItemAllFields"}},"LockedByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/LockedByUser"}},"ModifiedBy":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/ModifiedBy"}},"Properties":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/Properties"}},"VersionEvents":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/VersionEvents"}},"Versions":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv\')/Versions"}},"CheckInComment":"","CheckOutType":2,"ContentTag":"{BCEA2C34-14CC-4311-BE05-AEAF30166E17},1,1","CustomizedPageStatus":0,"ETag":"\\"{BCEA2C34-14CC-4311-BE05-AEAF30166E17},1\\"","Exists":true,"IrmEnabled":false,"Length":"5105807","Level":1,"LinkingUri":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv?d=wbcea2c3414cc4311be05aeaf30166e17","LinkingUrl":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv?d=wbcea2c3414cc4311be05aeaf30166e17","MajorVersion":1,"MinorVersion":0,"Name":"Rebate.csv","ServerRelativeUrl":"/sites/SPDevelopment/PLNMarginData/folder1/Rebate.csv","TimeCreated":"2022-09-23T11:57:19Z","TimeLastModified":"2022-09-23T11:57:19Z","Title":null,"UIVersion":512,"UIVersionLabel":"1.0","UniqueId":"bcea2c34-14cc-4311-be05-aeaf30166e17"},{"__metadata":{"id":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')","uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')","type":"SP.File"},"Author":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/Author"}},"CheckedOutByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/CheckedOutByUser"}},"EffectiveInformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/EffectiveInformationRightsManagementSettings"}},"InformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/InformationRightsManagementSettings"}},"ListItemAllFields":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/ListItemAllFields"}},"LockedByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/LockedByUser"}},"ModifiedBy":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/ModifiedBy"}},"Properties":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/Properties"}},"VersionEvents":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/VersionEvents"}},"Versions":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv\')/Versions"}},"CheckInComment":"","CheckOutType":2,"ContentTag":"{80E535DD-7B26-4136-A6F7-BC9C567AC436},1,1","CustomizedPageStatus":0,"ETag":"\\"{80E535DD-7B26-4136-A6F7-BC9C567AC436},1\\"","Exists":true,"IrmEnabled":false,"Length":"4315847","Level":1,"LinkingUri":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv?d=w80e535dd7b264136a6f7bc9c567ac436","LinkingUrl":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv?d=w80e535dd7b264136a6f7bc9c567ac436","MajorVersion":1,"MinorVersion":0,"Name":"AdditionalDiscount.csv","ServerRelativeUrl":"/sites/SPDevelopment/PLNMarginData/folder1/AdditionalDiscount.csv","TimeCreated":"2022-09-23T11:57:21Z","TimeLastModified":"2022-09-23T11:57:21Z","Title":null,"UIVersion":512,"UIVersionLabel":"1.0","UniqueId":"80e535dd-7b26-4136-a6f7-bc9c567ac436"},{"__metadata":{"id":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')","uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')","type":"SP.File"},"Author":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/Author"}},"CheckedOutByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/CheckedOutByUser"}},"EffectiveInformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/EffectiveInformationRightsManagementSettings"}},"InformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/InformationRightsManagementSettings"}},"ListItemAllFields":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/ListItemAllFields"}},"LockedByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/LockedByUser"}},"ModifiedBy":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/ModifiedBy"}},"Properties":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/Properties"}},"VersionEvents":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/VersionEvents"}},"Versions":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv\')/Versions"}},"CheckInComment":"","CheckOutType":2,"ContentTag":"{A47933D0-5F4E-42A1-AE5A-BD2E3E8FA3F1},1,1","CustomizedPageStatus":0,"ETag":"\\"{A47933D0-5F4E-42A1-AE5A-BD2E3E8FA3F1},1\\"","Exists":true,"IrmEnabled":false,"Length":"3361585","Level":1,"LinkingUri":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv?d=wa47933d05f4e42a1ae5abd2e3e8fa3f1","LinkingUrl":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv?d=wa47933d05f4e42a1ae5abd2e3e8fa3f1","MajorVersion":1,"MinorVersion":0,"Name":"PLN.csv","ServerRelativeUrl":"/sites/SPDevelopment/PLNMarginData/folder1/PLN.csv","TimeCreated":"2022-09-23T11:57:16Z","TimeLastModified":"2022-09-23T11:57:16Z","Title":null,"UIVersion":512,"UIVersionLabel":"1.0","UniqueId":"a47933d0-5f4e-42a1-ae5a-bd2e3e8fa3f1"},{"__metadata":{"id":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')","uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')","type":"SP.File"},"Author":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/Author"}},"CheckedOutByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/CheckedOutByUser"}},"EffectiveInformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/EffectiveInformationRightsManagementSettings"}},"InformationRightsManagementSettings":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/InformationRightsManagementSettings"}},"ListItemAllFields":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/ListItemAllFields"}},"LockedByUser":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/LockedByUser"}},"ModifiedBy":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/ModifiedBy"}},"Properties":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/Properties"}},"VersionEvents":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/VersionEvents"}},"Versions":{"__deferred":{"uri":"https://upllimited.sharepoint.com/sites/SPDevelopment/_api/Web/GetFileByServerRelativePath(decodedurl=\'/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv\')/Versions"}},"CheckInComment":"","CheckOutType":2,"ContentTag":"{AC9D7880-B925-486E-B8B9-C66668019AF0},1,1","CustomizedPageStatus":0,"ETag":"\\"{AC9D7880-B925-486E-B8B9-C66668019AF0},1\\"","Exists":true,"IrmEnabled":false,"Length":"4272105","Level":1,"LinkingUri":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv?d=wac9d7880b925486eb8b9c66668019af0","LinkingUrl":"https://upllimited.sharepoint.com/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv?d=wac9d7880b925486eb8b9c66668019af0","MajorVersion":1,"MinorVersion":0,"Name":"SalesDeduction.csv","ServerRelativeUrl":"/sites/SPDevelopment/PLNMarginData/folder1/SalesDeduction.csv","TimeCreated":"2022-09-23T11:57:18Z","TimeLastModified":"2022-09-23T11:57:18Z","Title":null,"UIVersion":512,"UIVersionLabel":"1.0","UniqueId":"ac9d7880-b925-486e-b8b9-c66668019af0"}]}}');
        //response.d.results = ['Sales_Deduction_1'];
        Test.setMock(HttpCalloutMock.class, new MockHttpSharepoint(200,'OK',JSON.serialize(res),new Map<String,String>()));
        Test.startTest();
        ConnectToSharePoint.readFilesName('folder1');
        Test.stopTest();
    }
                                                                          
    @isTest 
    static void testCallout2() {
		ConnectToSharePoint.AccessTokenResponse token = new ConnectToSharePoint.AccessTokenResponse();
        token.access_token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSIsImtpZCI6IjJaUXBKM1VwYmpBWVhZR2FYRUpsOGxWMFRPSSJ9.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAvdXBsbGltaXRlZC5zaGFyZXBvaW50LmNvbUA4YmM5N2Y5YS1lYTg2LTQ3MmUtOGFiNy0xOWRiNThjNGM4YWYiLCJpc3MiOiIwMDAwMDAwMS0wMDAwLTAwMDAtYzAwMC0wMDAwMDAwMDAwMDBAOGJjOTdmOWEtZWE4Ni00NzJlLThhYjctMTlkYjU4YzRjOGFmIiwiaWF0IjoxNjY0MTkyNTcxLCJuYmYiOjE2NjQxOTI1NzEsImV4cCI6MTY2NDI3OTI3MSwiaWRlbnRpdHlwcm92aWRlciI6IjAwMDAwMDAxLTAwMDAtMDAwMC1jMDAwLTAwMDAwMDAwMDAwMEA4YmM5N2Y5YS1lYTg2LTQ3MmUtOGFiNy0xOWRiNThjNGM4YWYiLCJuYW1laWQiOiJiMGJiY2VkZi1lZDQ1LTRhYTktYTllMy0xYmM1NmQzMWExYjRAOGJjOTdmOWEtZWE4Ni00NzJlLThhYjctMTlkYjU4YzRjOGFmIiwib2lkIjoiYmU5M2EyNDEtMDRlOS00MzY2LTk4ZWUtMjQ2Nzk0MjYwNGUwIiwic3ViIjoiYmU5M2EyNDEtMDRlOS00MzY2LTk4ZWUtMjQ2Nzk0MjYwNGUwIiwidHJ1c3RlZGZvcmRlbGVnYXRpb24iOiJmYWxzZSJ9.EUaTDMdn8-3TiRS44R2hirSSPA88ILQ64bzWiFQfG0drDtQrf7TL4ky3U2kyqgYC1EopL0UFuQN4dGJNdQj-8nrxeGf9107TxPC-SOp-mysvdOd-cHJHS8u3TBKxCrhuKNsTsupX1j4ja4J8mtz852NHp8ChmI5XRpBiAucre0MB5uutFrOz4gtCV1rehpaYLCjmZoBDx9QL3Jx8JaCmcXME4shGMKUhSE8Omlln2BdujfhRpdOVmMreKGCX_v2n9baGvZWmczVjderc9FQn2a-jqb7c5mS7BEAl6n25WN2rh1iuVlre5_VslrfqCIErH_ZvfsFKJCnZk36OyTmEHg';
        Test.setMock(HttpCalloutMock.class, new MockHttpSharepoint(200,'OK',JSON.serialize(token),new Map<String,String>()));        
        
        Test.startTest();
        ConnectToSharePoint.authentication();
        Test.stopTest();
    }
}